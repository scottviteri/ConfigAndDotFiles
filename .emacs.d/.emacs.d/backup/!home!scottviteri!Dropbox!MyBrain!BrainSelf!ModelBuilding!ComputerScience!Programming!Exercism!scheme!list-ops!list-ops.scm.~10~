(define-module (list-ops)
  #:export (my-length
            my-reverse
            my-map
            my-filter
            my-fold
            my-append
            my-concatenate
            ))

(use-modules (srfi srfi-1))

(define (my-fold op init lst)
  (define (loop acc l1)
    (if (nil? l1)
        acc
        (loop (op acc (car l1))
              (cdr l1))))
  (loop init lst)
  )

(define (compose f . rest)
  (my-fold (lambda (g h)
             (lambda (x) (g (h x))))
           f
           rest))

(define (inc x) (+ x 1))

(define (my-length lst)
  (my-fold (lambda (acc x) (inc acc)) 0 lst)
)

(define (my-reverse lst)
  (define (loop l1 l2)
    (if (nil? l1)
        l2
        (loop (cdr l1)
              (cons (car l1) l2))))
  (loop lst '())
)

(define (my-map f lst)
  (define (loop acc l1)
    (if (nil? l1)
        (my-reverse acc)
        (loop  (cons (f (car l1)) acc)
               (cdr l1))))
  (loop '() lst)
)

(define (my-append l1 l2)
  (define (loop l1' l2')
    (if (nil? l1')
        l2'
        (loop (cdr l1')
              (cons (car l1') l2'))))
  (loop (my-reverse  l1) l2)
)

(define (my-concatenate lst-of-lsts)
  (my-fold my-append '() lst-of-lsts))
